<script type="text/javascript" src="/js/main.js"></script>

<div class='container'>
    <h2>Configuration</h2>
    <form id='submitBridgeConfig'>
        <div class='form-group' style="width:40%; float:right;">
            <label for='bridgeUsername'>Username:</label>
            <input type='text' class='form-control' name='bridgeUsername' value='configJSON.bridge.username' />
        </div>
        <div class='form-group' style="width:40%;">
            <label for='bridgeName'>Name:</label>
            <input type='text' class='form-control' name='bridgeName' value='configJSON.bridge.name' />
        </div>

        <div class='form-group'>
            <div style="width:40%; ">
                <label for='pin'>Pin:</label>
                <input type='text' class='form-control' name='bridgePin' value='configJSON.bridge.pin'>
            </div>
        </div>

        <input type='submit' class='btn btn-default center-block' style='width:135px' value='Save' />
        <script>
            $("#submitBridgeConfig").submit(function(event) {
                event.preventDefault();
                $.post( "/api/saveBridgeConfig", $( "#submitBridgeConfig" ).serialize(), function() {
                    alert("Saved config.json.");
                })
                .fail(function(err) {
                    alert("Error while saving config.json:\n" + err.responseJSON.error);
                });
            });
        </script>
    </form>

    <hr>
    <h2>Platforms</h2>
    <div class="responsive-wrapper">
        <div class="row header" id="platformsTableHeader">
            <div><span style='font-size: larger;'>&#x2139;</span></div>
            <div>Type</div>
            <div>Name</div>
            <div>Config</div>
            <div>Usage</div>
        </div>
        <div id="platformsTable"></div>
    </div>
    <a href='/addPlatform' name='AddPlatform' class='btn btn-default center-block' style='width:135px'>Add</a><br>

    <hr>
    <h2>Accessories</h2>
    <div class="responsive-wrapper">
        <div class="row header" id="accessoriesTableHeader">
            <div>Status</div>
            <div>Type</div>
            <div>Name</div>
            <div>Config</div>
            <div></div>
        </div>
        <div id="accessoriesTable">
            <script>
                $.getJSON("/api/accessories", function(data) {
                    if (data.length === 0) {
                        $("#accessoriesTableHeader").hide();
                        $("#accessoriesTable").text("No accessories installed or configured!");
                    } else {
                        $("#accessoriesTableHeader").show();
                        $("#accessoriesTable").empty();
                        $.each(data, function(id_accessory, accessory) {
                            var conf = configFromData(accessory);
                            var activeIndicator = accessory.hbServer_active_flag === 1 ? "active" : "inactive";
                            var row = "<div class='row content'> \
                                        <div>" + activeIndicator + "</div>\
                                        <div>" + accessory.accessory + "<br\>(" + accessory.hbServer_pluginName + ")</div>\
                                        <div>" + accessory.name + "</div> \
                                        <div><pre>" + conf + "</pre></div>\
                                        <div><a href='/removeAccessory?id=" + id_accessory + "' class='btn btn-default center-block' style='height: 34px; line-height: 16px; vertical-align:middle;outline:none !important;'><span style='font-size:25px;''>&#128465;</span></a></div>\
                                      </div>";
                            $("#accessoriesTable").append(row);
                        });
                    }
                });
            </script>
        </div>
    </div>
    <a href='/addAccessory' name='AddAccessory' class='btn btn-default center-block' style='width:135px'>Add</a><br>
</div>

<div class="modal" tabindex="-1" role="dialog" id="confirmRemoveModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Really remove this platform?</h4>
                <div>Do you really want to delete this platform? This cannot be undone.<br />
                    Consider making a backup first.
                </div>
                <input type=hidden id="confirmRemoveModalPlatformID" value="" />
            </div>
            <div class="modal-footer">
                <div id="confirmRemoveModalStatus" style="float: left;"></div>
                <button type="button" class="btn" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="removePlatformConfig();">Remove</button>
            </div>
        </div>
    </div>
</div>

<div class="modal" tabindex="-1" role="dialog" id="editModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="editModalTitle"></h4>
                <input type=hidden id="editModalplatformID" value="" />
            </div>
            <div class="modal-body">
                <div>
                    Plugin for this platform: <select name="editModalPlugin" id="editModalPlugins"></select>
                </div>
                <div><textarea id="editModalContainer" rows="10" cols="50"></textarea></div>
            </div>
            <div class="modal-footer">
                <div id="editModalStatus" style="float: left;"></div>
                <button type="button" class="btn" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="savePlatformEdit();">Save</button>
            </div>
        </div>
    </div>
</div>

<script>
    listPlatforms();
    $.getJSON( "/api/bridgeConfig", function( data ) {
        $( "input[name='bridgeName']" ).val(data.bridgeName);
        $( "input[name='bridgeUsername']" ).val(data.bridgeUsername);
        $( "input[name='bridgePin']" ).val(data.bridgePin);
    });
</script>
